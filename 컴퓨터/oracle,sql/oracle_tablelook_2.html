<!-- 글 제목, 카테고리, 글쓴 날짜 -->
<DIV class=titleinfo>
<H2><A href="/647">오라클 LOCK 조회 및 KILL 방법</A></H2>
<DIV class=name><A href="/category/컴퓨터활용/오라클">컴퓨터활용/오라클</A></DIV>
<DIV class=date>2011/11/30 16:18</DIV></DIV>
<SCRIPT type=text/javascript><!--
google_ad_client = "ca-pub-6789626216297475";
/* 가로 리더 보드 배너 */
google_ad_slot = "7651870517";
google_ad_width = 728;
google_ad_height = 90;
//-->
</SCRIPT>

<SCRIPT type=text/javascript src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</SCRIPT>
<INS style="BORDER-BOTTOM: medium none; POSITION: relative; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; WIDTH: 728px; PADDING-RIGHT: 0px; DISPLAY: inline-table; HEIGHT: 90px; VISIBILITY: visible; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px"><INS style="BORDER-BOTTOM: medium none; POSITION: relative; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; WIDTH: 728px; PADDING-RIGHT: 0px; DISPLAY: block; HEIGHT: 90px; VISIBILITY: visible; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px" id=aswift_1_anchor><IFRAME style="POSITION: absolute; TOP: 0px; LEFT: 0px" id=aswift_1 vspace=0 onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){i+='.call';setTimeout(h,0)}else if(h.match){i+='.nav';w.location.replace(h)}s.log&amp;&amp;s.log.push(i)}" height=90 marginHeight=0 frameBorder=0 width=728 allowTransparency name=aswift_1 marginWidth=0 scrolling=no hspace=0></IFRAME></INS></INS><!-- 본문 -->
<DIV class=article><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">프로젝트에서 LOCK 이 자주 걸리는 문제가 발생하여 연구하던 중에 아래의 sql 문을 이용하여 lock 세션을 찾아서 관리할 수 있다는 것을 알았다. 그러나 이 SQL 은 System 유저만이 사용할 수 있다는&nbsp; 제약이 있다. </SPAN><BR><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0)"><SPAN style="FONT-SIZE: 11pt">LOCK 이 발생하게 되면 프로그램이 동작하다가 멈추고 기다리게 된다. 원인을 파악하는데 시간이 허비하게 되는데 알고 보니 테이블에 LOCK이 걸린 것이었다면 허탈함을 금할 수 없다.&nbsp; 자주 LOCK 이 걸리는 테이블이라면 SELECT 할 때 WAIT 타임을 1 정도로 주면 1초동안 LOCK 이 풀리기를 대기하다가 오류 처리되므로 개발자가 쉽게 LOCK 걸린 상황을 인지할 수 있다. </SPAN></SPAN><BR><BR><SPAN style="COLOR: rgb(95,182,54); FONT-WEIGHT: bold"><SPAN style="FONT-SIZE: 11pt">-- 락걸린 테이블 확인 </SPAN></SPAN><BR><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">SELECT&nbsp; DO.OBJECT_NAME, DO.OWNER, DO.OBJECT_TYPE, DO.OWNER,</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VO.XIDUSN, VO.SESSION_ID, VO.LOCKED_MODE</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">FROM&nbsp;&nbsp;&nbsp; V$LOCKED_OBJECT VO, DBA_OBJECTS DO</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">WHERE&nbsp;&nbsp; VO.OBJECT_ID = DO.OBJECT_ID;</SPAN><BR><BR><SPAN style="COLOR: rgb(95,182,54); FONT-WEIGHT: bold"><SPAN style="FONT-SIZE: 11pt">-- 해당 테이블에 LOCK 이 걸렸는지.</SPAN></SPAN><BR><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">SELECT A.SID, A.SERIAL#, B.TYPE, C.OBJECT_NAME</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">FROM V$SESSION A, V$LOCK B, DBA_OBJECTS C</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">WHERE A.SID = B.SID AND B.ID1 = C.OBJECT_ID</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">AND B.TYPE='TM' AND C.OBJECT_NAME IN ('TB_CO_GENO');</SPAN><BR><BR><SPAN style="COLOR: rgb(95,182,54); FONT-WEIGHT: bold"><SPAN style="FONT-SIZE: 11pt">-- 락발생 사용자와 SQL, OBJECT 조회</SPAN></SPAN><BR><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">SELECT DISTINCT X.SESSION_ID, A.SERIAL#, D.OBJECT_NAME, A.MACHINE, A.TERMINAL,</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A.PROGRAM, B.ADDRESS, B.PIECE, B.SQL_TEXT</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">FROM V$LOCKED_OBJECT X, V$SESSION A, V$SQLTEXT B, DBA_OBJECTS D</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">WHERE X.SESSION_ID = A.SID AND </SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">X.OBJECT_ID = D.OBJECT_ID AND A.SQL_ADDRESS = B.ADDRESS </SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">ORDER BY B.ADDRESS, B.PIECE;</SPAN><BR><BR><SPAN style="COLOR: rgb(95,182,54)"><SPAN style="FONT-SIZE: 11pt"></SPAN></SPAN><SPAN style="COLOR: rgb(95,182,54); FONT-WEIGHT: bold"><SPAN style="FONT-SIZE: 11pt">-- 현재 접속자의 SQL 분석</SPAN></SPAN><BR><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">SELECT DISTINCT A.SID, A.SERIAL#,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A.MACHINE, A.TERMINAL, A.PROGRAM,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B.ADDRESS, B.PIECE, B.SQL_TEXT<BR>FROM&nbsp; V$SESSION A, V$SQLTEXT B<BR>WHERE A.SQL_ADDRESS = B.ADDRESS<BR>ORDER BY A.SID, A.SERIAL#, B.ADDRESS, B.PIECE</SPAN><BR><BR><SPAN style="COLOR: rgb(95,182,54); FONT-WEIGHT: bold"><SPAN style="FONT-SIZE: 11pt">-- 락 세션 죽이기</SPAN></SPAN><BR style="COLOR: rgb(95,182,54)"><SPAN style="COLOR: rgb(95,182,54)"><SPAN style="FONT-SIZE: 11pt"></SPAN></SPAN><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp; SELECT A.SID,&nbsp;&nbsp; A.SERIAL#</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp; FROM V$SESSION A,&nbsp; V$LOCK B,</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DBA_OBJECTS C</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp;WHERE A.SID = B.SID</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp;&nbsp; AND B.ID1 = C.OBJECT_ID</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp;&nbsp; AND B.TYPE = 'TM'</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp;&nbsp; AND C.OBJECT_NAME = 'TB_CO_GENO'</SPAN><BR><SPAN style="WIDTH: 1px; FLOAT: right; HEIGHT: 1px" id=callbacknestpangatecom6474950><EMBED id=bootstrapperpangatecom6474950 height=1 type=application/x-shockwave-flash width=1 src=http://pangate.com/plugin/CallBack_bootstrapperSrc?nil_profile=tistory&amp;nil_type=copied_post swLiveConnect="true" FlashVars="&amp;callbackId=pangatecom6474950&amp;host=http://pangate.com&amp;embedCodeSrc=http%3A%2F%2Fpangate.com%2Fplugin%2FCallBack_bootstrapper%3F%26src%3Dhttp%3A%2F%2Fs1.daumcdn.net%2Fcfs.tistory%2Fv%2F0%2Fblog%2Fplugins%2FCallBack%2Fcallback%26id%3D647%26callbackId%3Dpangatecom6474950%26destDocId%3Dcallbacknestpangatecom6474950%26host%3Dhttp%3A%2F%2Fpangate.com%26float%3Dleft" EnableContextMenu="false" wmode="transparent" allowscriptaccess="always"></SPAN> <SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp;&nbsp; </SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">SID SERIAL#</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">--- -------</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">5&nbsp;&nbsp; 1</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">6&nbsp;&nbsp; 1</SPAN><BR style="COLOR: rgb(0,0,0)"><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">2. 다음 명령으로 SESSION들을 KILL한다.</SPAN>&nbsp; <SPAN style="COLOR: rgb(95,182,54)"><SPAN style="FONT-SIZE: 11pt">ALTER SYSTEM KILL SESSION 'SESSION_ID, SERIAL#';</SPAN></SPAN><BR><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">SQL&gt; alter system kill session '5, 1';</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">SQL&gt; alter system kill session '6, 1';</SPAN><BR><BR><BR><SPAN style="COLOR: rgb(95,182,54); FONT-WEIGHT: bold"><SPAN style="FONT-SIZE: 11pt">-- 락 세션 죽이는 sql 문 </SPAN></SPAN><BR><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">SELECT DISTINCT X.SESSION_ID, A.SERIAL#, D.OBJECT_NAME, A.MACHINE, A.TERMINAL,</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A.PROGRAM, A.LOGON_TIME, 'ALTER SYSTEM KILL SESSION'''||A.SID||', '||A.SERIAL#||''';'</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">FROM GV$LOCKED_OBJECT X, GV$SESSION A, DBA_OBJECTS D</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">WHERE&nbsp; X.SESSION_ID = A.SID AND X.OBJECT_ID = D.OBJECT_ID</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">ORDER BY LOGON_TIME;</SPAN><BR><SPAN id=content><PRE><BR>
</PRE></SPAN><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt; FONT-WEIGHT: bold">자주 발생하는 LOCK 문제들</SPAN><BR><SPAN style="FONT-SIZE: 11pt">-------------------------</SPAN><BR><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">1. Parent-Child 관계로 묶인 테이블에서 Child 테이블에 Index가 없는 상황에서 Child 테이블을 수정하게 되면 Parent테이블에 TABLE LEVEL SHARE LOCK이 걸리게 되어서 Parent 테이블에 대한 모든 Update가 금지된다.</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">2. 블럭의 PCTFREE가 매우 작다면 한 블럭에 여러개의 레코드가 들어 있기 때문에 한 블럭에 과도한 트랜잭션이 들어와서 블럭의 Transaction Layer가 Release 되기를 기다리게 되는 경우도 있다.</SPAN><BR style="COLOR: rgb(0,0,0)"><SPAN style="COLOR: rgb(0,0,0); FONT-SIZE: 11pt">3. Transaction을 직접 처리하는 경우 (@Transaction을 사용하지 않고 @Override 를 사용) commit 이나 rollback 하지 않고 바로 빠져 나가는 경우에도 lock 이 발생될 수 있다. 거래가 바로 빠져 나가는 경우는 exception 이 발생했으나 catch 를 제대로 하지 못 한 경우가 흔하다</SPAN>.<BR><BR><BR><SPAN style="COLOR: rgb(0,0,0)">다음은 &lt;http://www.medianart.com/288&gt; 에서 퍼온 글입니다. 내가 궁금하던 것을 잘 정리해 놓으셨군요~</SPAN><BR>
<DIV style="BORDER-BOTTOM: rgb(238,238,238) 1px solid; BORDER-LEFT: rgb(238,238,238) 1px solid; PADDING-BOTTOM: 10px; BACKGROUND-COLOR: rgb(238,238,238); PADDING-LEFT: 10px; PADDING-RIGHT: 10px; BORDER-TOP: rgb(238,238,238) 1px solid; BORDER-RIGHT: rgb(238,238,238) 1px solid; PADDING-TOP: 10px" class=txc-textbox><SPAN style="LINE-HEIGHT: 24px; FONT-FAMILY: 굴림, Gulim, dotum, 돋움, sans-serif" class=Apple-style-span><SPAN style="FONT-WEIGHT: bold">LOCK의 유형</SPAN><BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp; 데이타의 concurrency를 보장하기 위해 오라클은 lock과 transaction을 사용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp; Lock은 같은 자원을 access하는 사용자들 사이에 상호간에 해를 끼치는 것을 예방하기&nbsp;&nbsp; <BR>&nbsp;&nbsp; 위해서 사용되는 메카니즘이다.<BR style="LINE-HEIGHT: 2em"><SPAN style="FONT-WEIGHT: bold">&nbsp;&nbsp; Lock의 종류</SPAN><BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Exclusive : lock이 걸린 자원의 공유를 허용하지 않는다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Share : 자원에 대해 수행되는 명령의 유형에 따라 lock된 자원의 공유되는 것을&nbsp; 허용한다.<BR style="LINE-HEIGHT: 2em"><SPAN style="FONT-WEIGHT: bold">&nbsp;&nbsp; 오라클에서의 Lock의 일반적인 범주</SPAN><BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Data or DML (row locks TX and table locks TM) : 동시에 다중의 사용자에 의해<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access되는 테이블 데이타의 보호를 위해 사용된다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Dictionary or DDL(TD) : 트랜잭션에서 access되는 테이블과 같은 Object의 정의를<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;보호하기 위해서 사용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Internal and Latches (RT, MR) : SGA 영역에서의 내부적인 데이타베이스와 메모리<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;구조를 보호하기 위해 사용한다.<BR style="LINE-HEIGHT: 2em"><SPAN style="COLOR: rgb(0,0,0); FONT-WEIGHT: bold">&nbsp;&nbsp; 1. TABLE LOCKS</SPAN><BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;테이블의 특정한 row를 수정하는 문장은 항상 그러한 row에 대해 exclusive row lock<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;을 획득하고 테이블 lock을 전유한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1) Row Share Table Locks (RS)<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- row를 lock 시키고 lock된 테이블을 UPDATE 할 목적이다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 모든 row를 SELECT 하려는 다른 트랜잭션을 허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 동일 테이블에서 lock 되지 않은 row를 INSERT, UPDATE, DELETE 하는 다른&nbsp; 트랜잭션을 허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 테이블에 대한 ROW SHARE, ROW EXCLUSIVE, SHARE, SHARE ROW EXCLUSIVE lock<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;을 획득하려는 다른 트랜잭션을 허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- EXCLUSIVE 모드에서의 테이블 locking으로부터 다른 트랜잭션을 예방한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2) Row Exclusive Table Locks (RX)<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- row를 lock 시키고 테이블에서 row를 변화시킨다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 모든 row를 SELECT 하려는 다른 트랜잭션을 허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 동일 테이블에서 lock 되지 않은 row를 INSERT, UPDATE, DELETE 하는 다른<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;트랜잭션을 허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 테이블에 대한 ROW SHARE, ROW EXCLUSIVE lock을 획득하려는 다른 트랜잭션을<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- SHARE, EXCLUSIVE, SHARE ROW EXCLUSIVE 모드에서의 테이블 locking으로부터<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;다른 트랜잭션을 예방한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3) Share Table Locks (S)<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 다른 트랜잭션을 제공하지 않는 테이블에서 row를 INSERT, UPDATE, DELETE<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;하는 것이 SHARE lock을 홀딩한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 동일 테이블에서 지정된 row를 QUERY 또는 LOCK 하려는 다른 트랜잭션을&nbsp; 허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 테이블에 대해 더 나아가 SHARE lock을 얻으려는 다른 트랜잭션을 허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- EXCLUSIVE 또는 SHARE ROW EXCLUSIVE 모드로 테이블을 locking 하는 것으로<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;부터 다른 트랜잭션을 보호한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4) Share Row Exclusive Table Locks (SRX)<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 테이블에 row를 INSERT, UPDATE, DELETE 한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 동일 테이블에서 지정된 row를 QUERY 또는 LOCK 하려는 다른 트랜잭션을&nbsp;&nbsp; 허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- SHARE, EXCLUSIVE 또는 SHARE ROW EXCLUSIVE 모드로 테이블을 locking 하는 것으로<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;부터 다른 트랜잭션을 보호한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5) Exclusive Table Locks (S)<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 테이블에 row를 INSERT, UPDATE, DELETE 한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 동일 테이블에서 지정된 row를 QUERY하는 것에 대해서만 다른 트랜잭션을<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;허용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 어떠한 lock 문장을 내리는 것으로부터 다른 트랜잭션을 보호한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;<SPAN style="FONT-WEIGHT: bold"> 2. DICTIONARY LOCKS</SPAN><BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dictionary lock은 Object에 대한 DDL 명령이 수행되는 동안 Object의 정의를&nbsp; 보호한다.<BR style="LINE-HEIGHT: 2em"><SPAN style="FONT-WEIGHT: bold">&nbsp;&nbsp; 3. INTERNAL LOCKS 과 LATCHES</SPAN><BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Latches 와 Internal lock은 메모리 구조를 보호하기 위한 메카니즘이다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Latches 는 SGA 영역에 있는 shared data structure를 보호하기 위한 low-level&nbsp;&nbsp;&nbsp; 연속 메카니즘이다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Internallock은 data dictionary entry를 보호하고 database file, tablespace,&nbsp; rollback segment를 lock한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Latches 와 Internal locks는 데이타베이스 사용자에 의해 컨트롤 될 수 없다.<BR style="LINE-HEIGHT: 2em"><BR style="LINE-HEIGHT: 2em"><SPAN style="FONT-WEIGHT: bold">LOCK에 대한 모니터</SPAN><BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp; lock contention 과 병목현상은 시스템의 효능을 저하시킨다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp; 1. 모니터 방법<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1) SQL*DBA 모니터 lock display<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2) V$LOCK view<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3) utllockt.sql 이라는 스크립트 화일의 내용을 확인<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(lock이 된 자원을 기다리는 사용자가 있는지를 보여줌)<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp; 2. SQL*DBA lock monitor 를 사용한 모니터 방법<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Lock 모니터의 Resource ID 1 필드는 DBA_OBJECTS 에서의 object_id 이다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Lock 모니터의 특정한 Resource ID 1 과 일치하는 테이블명을 찾기 위해서는&nbsp;&nbsp; 다음 Query를 사용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SQL&gt; SELECT owner, object_id, object_name, object_type<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM dba_objects<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHERE object_id = resource id #;<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;▶ LOCK monitor의 컬럼들<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Username : 연결된 사용자의 명<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Session ID : 사용자 연결을 식별하기 위해 오라클에서 제공되는 ID<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial Number : 세션의 시리얼 번호로 각각의 세션을 유일한 번호로 지정하기 위해&nbsp; Session ID를 함께 사용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Lock Type : TM은 데이타 조작에 대해 dictionary lock을 표시한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Resource ID 1 필드는 lock이 걸린 테이블의 ID이다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;테이블명을 찾아보려면 DBA_OBJECTS 쿼리를 사용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TM lock은 트랜잭션 lock이다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;지시하는 row는 lock이 걸리거나 lock 되기 위해 요청된다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Resource ID 1 : TM 형태의 lock에 대해 DBA_OBJECTS view로 찾은 테이블 ID를 보여준다. 다른 값은 무시될 수 있다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Resource ID 2 : 내부적으로 lock의 형태를 식별하기 위해 사용한다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mode Held : 자원을 쥐고 있는 lock의 모드를 나타낸다.<BR style="LINE-HEIGHT: 2em">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mode Requested : 자원에게 요청된 lock의 모드를 나타낸다.</SPAN></DIV><BR><BR><BR><BR>
<DIV class="another_category another_category_color_blue">
<H4>'<A href="/category/컴퓨터활용">컴퓨터활용</A>&nbsp;&gt;&nbsp;<A href="/category/컴퓨터활용/오라클">오라클</A>' 카테고리의 다른 글</H4>
<TABLE>
<TBODY>
<TR>
<TH><A href="/651">오라클 테이블의 디스크 용량 예측</A>&nbsp;&nbsp;<SPAN>(0)</SPAN> </TH>
<TD>2011/12/05</TD></TR>
<TR>
<TH><A href="/648">Oracle Locking Survival Guide</A>&nbsp;&nbsp;<SPAN>(0)</SPAN> </TH>
<TD>2011/12/01</TD></TR>
<TR>
<TH><A class=current href="/647">오라클 LOCK 조회 및 KILL 방법</A>&nbsp;&nbsp;<SPAN>(0)</SPAN> </TH>
<TD>2011/11/30</TD></TR>
<TR>
<TH><A href="/613">오라클 매뉴얼</A>&nbsp;&nbsp;<SPAN>(0)</SPAN> </TH>
<TD>2011/04/04</TD></TR>
<TR>
<TH><A href="/560">Golden 에서 접속 오류 날 때</A>&nbsp;&nbsp;<SPAN>(0)</SPAN> </TH>
<TD>2010/06/02</TD></TR>
<TR>
<TH><A href="/644">INDEX_DESC HINT</A>&nbsp;&nbsp;<SPAN>(0)</SPAN> </TH>
<TD>2009/11/07</TD></TR></TBODY></TABLE></DIV></DIV><!--
            <div class="author">
              Posted by 멜번초이
            </div>
          -->
<TABLE>
<TBODY>
<TR>
<TD width="40%">
<SCRIPT type=text/javascript><!--
    google_ad_client = "ca-pub-6789626216297475";
    /* 300x250, 작성됨 11. 4. 3 */
    google_ad_slot = "1609661549";
    google_ad_width = 300;
    google_ad_height = 250;
    //-->
    </SCRIPT>

<SCRIPT type=text/javascript src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
    </SCRIPT>
<INS style="BORDER-BOTTOM: medium none; POSITION: relative; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; WIDTH: 300px; PADDING-RIGHT: 0px; DISPLAY: inline-table; HEIGHT: 250px; VISIBILITY: visible; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px"><INS style="BORDER-BOTTOM: medium none; POSITION: relative; BORDER-LEFT: medium none; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; WIDTH: 300px; PADDING-RIGHT: 0px; DISPLAY: block; HEIGHT: 250px; VISIBILITY: visible; BORDER-TOP: medium none; BORDER-RIGHT: medium none; PADDING-TOP: 0px" id=aswift_2_anchor><IFRAME style="POSITION: absolute; TOP: 0px; LEFT: 0px" id=aswift_2 vspace=0 onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){i+='.call';setTimeout(h,0)}else if(h.match){i+='.nav';w.location.replace(h)}s.log&amp;&amp;s.log.push(i)}" height=250 marginHeight=0 frameBorder=0 width=300 allowTransparency name=aswift_2 marginWidth=0 scrolling=no hspace=0></IFRAME></INS></INS></TD>
<TD><A href="http://breadkingdom.com"><IMG src="http://cfile22.uf.tistory.com/image/197A873F4E508DDA108471"></A> </TD></TR></TBODY></TABLE><!-- 본문 관련 태그 -->
<DIV class=tag><IMG alt=태그 src="http://ts.daumcdn.net/custom/blog/18/180633/skin/images/iconTag.gif"> <A href="/tag/Lock" rel=tag>Lock</A>, <A href="/tag/락" rel=tag>락</A>, <A href="/tag/오라클" rel=tag>오라클</A> </DIV><!-- 트랙백과 댓글 버튼-->
<DIV class=btnTrackbackComment><A onclick="toggleLayerForEntry(647, 'trackback'); return false" href="#tb"><SPAN id=trackbackCount647>트랙백 <SPAN class=cnt>0</SPAN></SPAN></A> : <A onclick="toggleLayerForEntry('647', 'comment'); return false" href="#rp"><SPAN id=commentCount647>댓글 <SPAN class=cnt>0</SPAN></SPAN></A> </DIV><!-- 트랙백-->
<DIV style="DISPLAY: block" id=entry647Trackback>
<DIV class=trackback><!-- 트랙백 받을 주소 -->
<H3>트랙백 보낼 주소 :: <SPAN class=address><SPAN style="CURSOR: text" class=trackback-url>http://pangate.com/trackback/647</SPAN> <SPAN style="MARGIN-LEFT: 1px; VERTICAL-ALIGN: -4px" id=TrackbackCopyHolder647>
<SCRIPT type=text/javascript>
	//<![CDATA[
	AC_FL_RunContent(
		'src','http://s1.daumcdn.net/cfs.tistory/v/0/blog/script/copyTrackback',
		'Flashvars','url=http://pangate.com/trackback/647&mode=whiteButton',
		'width','29',
		'height','18',
		'id', 'TrackbackCopyButton647',
		'wmode','transparent',
		'allowScriptAccess','always',
		'type','application/x-shockwave-flash',
		'pluginspage','http://www.macromedia.com/go/getflashplayer'
	);
	//]]>
	</SCRIPT>

<OBJECT id=TrackbackCopyButton647 classid=clsid:d27cdb6e-ae6d-11cf-96b8-444553540000 width=29 height=18 type=application/x-shockwave-flash><PARAM NAME="_cx" VALUE="767"><PARAM NAME="_cy" VALUE="476"><PARAM NAME="FlashVars" VALUE="url=http://pangate.com/trackback/647&amp;mode=whiteButton"><PARAM NAME="Movie" VALUE="http://s1.daumcdn.net/cfs.tistory/v/0/blog/script/copyTrackback.swf"><PARAM NAME="Src" VALUE="http://s1.daumcdn.net/cfs.tistory/v/0/blog/script/copyTrackback.swf"><PARAM NAME="WMode" VALUE="Transparent"><PARAM NAME="Play" VALUE="0"><PARAM NAME="Loop" VALUE="-1"><PARAM NAME="Quality" VALUE="High"><PARAM NAME="SAlign" VALUE="LT"><PARAM NAME="Menu" VALUE="-1"><PARAM NAME="Base" VALUE=""><PARAM NAME="AllowScriptAccess" VALUE="always"><PARAM NAME="Scale" VALUE="NoScale"><PARAM NAME="DeviceFont" VALUE="0"><PARAM NAME="EmbedMovie" VALUE="0"><PARAM NAME="BGColor" VALUE=""><PARAM NAME="SWRemote" VALUE=""><PARAM NAME="MovieData" VALUE=""><PARAM NAME="SeamlessTabbing" VALUE="1"><PARAM NAME="Profile" VALUE="0"><PARAM NAME="ProfileAddress" VALUE=""><PARAM NAME="ProfilePort" VALUE="0"><PARAM NAME="AllowNetworking" VALUE="all"><PARAM NAME="AllowFullScreen" VALUE="false"><PARAM NAME="AllowFullScreenInteractive" VALUE="">
 > > > ></OBJECT></SPAN><SPAN><A onclick="window.open(this.href); return false" href="http://www.tistory.com/gateway/?trackback=http%3A%2F%2Fpangate.com%2Ftrackback%2F647&amp;defaultAdmin=%2Fadmin"><IMG style="VERTICAL-ALIGN: -4px; _margin-left: 5px" title="" alt="관련글 쓰기" src="http://i1.daumcdn.net/cfs.tistory/v/0/static/admin/btn_track_white.gif"> </A></SPAN></SPAN></H3><!-- 받은 트랙백 리스트 -->
<DIV class=list>
<OL></OL></DIV></DIV></DIV>
<SCRIPT type=text/javascript>loadedTrackbacks[647]=true;</SCRIPT>
<!-- 댓그 -->
<DIV style="DISPLAY: block" id=entry647Comment>
<FORM style="MARGIN: 0px" onsubmit="return false" method=post action=/comment/add/647>
<DIV class=comment><!-- 댓글 타이틀 -->
<H3>댓글을 달아주세요:: <SPAN class=address>네티켓은 기본, 스팸은 사절</SPAN></H3><!-- 댓글 리스트 -->
<DIV class=list>
<OL></OL></DIV><!-- 댓글 쓰기 양식 -->
<DIV class=write>
<P><INPUT id=name_647 type=text name=name> <LABEL for=name_647>: 이름 (name) </LABEL></P>
<P><INPUT id=password_647 value="" maxLength=8 type=password name=password> <LABEL for=password_647>: 비밀번호 (password) </LABEL></P>
<P><INPUT id=homepage_647 class=homepage value=http:// type=text name=homepage> <LABEL for=homepage_647>: 홈페이지 (homepage)</LABEL> </P><!--
                  <p>
                    <input type="checkbox" id="secret_647" name="secret" class="checkbox" />
                    <label for="secret_647"> 비밀글 </label>
                  </p>
-->
<P><TEXTAREA id=comment_647 rows=6 cols=60 name=comment></TEXTAREA> </P>
<P><INPUT class=btn onclick="addComment(this, 647); return false;" value=확인 type=submit> </P></DIV></DIV><!-- 닫기 comment --></FORM></DIV>
<SCRIPT type=text/javascript>loadedComments[647]=true;highlight()</SCRIPT>